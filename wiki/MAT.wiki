#summary Material Definitions
= Introduction =

Material definitions for the M3 model. Materials act as a container for a group of bitmaps such as diffuse, specular, emissive, etc. They have general properties that play a role in how the bitmaps are ultimately rendered on the model. [MATM] are referenced in the [DIV] [BAT] matid's and function as a lookup table into these definitions.

= Details =
Alot of the details have been determined through the previewer.

{{{
// Size = 268 bytes / 0x10C bytes
// Incomplete
struct MAT
{
    Reference name;
    uint32 d1;
    uint32 flags;
    uint32 blendMode;
    uint32 priority;
    uint32 d2;
    float specularity;
    uint32 d3;
    uint32 cutoutThresh;
    float SpecMult;
    float EmisMult;
    Reference layers[13];
    uint32 d4;
    uint32 layerBlend;
    uint32 emisBlend;
    uint32 d5; //controls emissive blending in someway, should be set to 2
    uint32 specType;
    Aref_UINT32 ar1;
    Aref_UINT32 ar2;
};

}}}

== Layers ==
Each layer index corresponds to a specific type of map. Some don't appear to do anything, even the previewer doesn't disclose their purpose. It's been found that some of the maps don't need to point to a real map to still have an effect on the material, such as Alpha Map properties when the alpha blend modes are used. More on that in the LAYR definition. Each LAYR must have a referenced chunk even if it's blank or else the previewer will crash.

|| *Layer Index* || *Map Type* ||
|| 0 || Diffuse|| 
|| 1 || Decal ||  
|| 2 || Specular || 
|| 3 || Emissive (1) || 
|| 4 || Emissive (2) || 
|| 6 || Envio (Reflective) || 
|| 7 || Envio Mask || 
|| 8 || Alpha Mask || 
|| 10 || Normal || 
|| 11 || Height ||

== Flags ==
Most of these determined through the previewer.

|| *Bit Index* || *Bit Address* || * Flag * ||
|| 3 || 0x4 || Unfogged (1) || 
|| 4 || 0x8 || Two-sided ||  
|| 5 || 0x10 || Unshaded || 
|| 6 || 0x20 || No shadows cast || 
|| 7 || 0x40 || No hit test || 
|| 8 || 0x80 || No shadows received || 
|| 9 || 0x100 || Depth prepass ||
|| 10 || 0x200 || Use terrain HDR || 
|| 12 || 0x800 || Splat UV fix ||
|| 13 || 0x1000 || Soft blending ||
|| 14 || 0x2000 || Unfogged (2) ||

== Blendmodes ==
|| *Value* || *Mode* ||
|| 0 || Opaque || 
|| 1 || Alpha Blend ||  
|| 2 || Add || 
|| 3 || Alpha Add || 
|| 4 || Mod || 
|| 5 || Mod 2x || 

== Layer/Emissive Blendmodes ==
|| *Value* || *Mode* ||
|| 0 || Mod || 
|| 1 || Mod 2x ||  
|| 2 || Add || 
|| 3 || Blend || 
|| 4 || Team Colour Emissive Add || 
|| 5 || Team Colour Diffuse Add || 

== Specular Types ==
|| *Value* || *Type* ||
|| 0 || RGB || 
|| 1 || Alpha Only || 