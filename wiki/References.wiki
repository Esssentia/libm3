#summary M3 references.

= Introduction =

The .m3 files contain references in a different way than previous versions of the MDX format.


= Details =

The file header contains the number of reference lists in the file, along with the offset where their headers start.

Each reference header contains the data type in the list, the number of entries in that list, along with the offset where that list starts.

There is a fourth value in the reference header, which purpose is unknown. But the size of the block can depend on this value.
For example the MODL block in units/buildings have a different value here compared to the MODL block in skyboxes, and the size of the block / number of fields in the block is different.

Each animation sequence has related SD-blocks which references the data used by the animation. Animation references used in bones use a unique uint32 ID to reference sequence data found in STC.

{{{
// Size = 8 byte / 0x08 byte
// Complete
struct Reference 
{
    /*0x00*/ uint32 nEntries;
    /*0x04*/ uint32 ref;
};

// Size = 16 byte / 0x10 byte
// Incomplete
struct ReferenceEntry 
{ 
    /*0x00*/ char id[4]; 
    /*0x04*/ uint32 offset; 
    /*0x08*/ uint32 nEntries; 
    /*0x0C*/ uint32 d1; // Possibly nReferences;
};

// Size = 8 Byte / 0x08 byte
// Incomplete
struct AnimationReference
{
    /*0x00*/ uint16 flags; //usually 1
    /*0x02*/ uint16 animflag; //6 indicates animation data present
    /*0x04*/ uint32 animid; //a unique uint32 value referenced in STC.animid and STS.animid
};
}}}